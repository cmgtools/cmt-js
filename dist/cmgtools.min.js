/**
 * CMGTools JS - v1.0.0-alpha1 - 2015-11-18
 * Description: CMGTools JS is a JavaScript library which provide utilities, ui components and MVC framework implementation for CMSGears.
 * License: GPLv3
 * Author: Bhagwat Singh Chouhan
 */
function showPopup(a){jQuery(a).fadeIn("slow")}function closePopup(a){jQuery(a).fadeOut("slow")}function showErrorPopup(a){jQuery("#error-popup .popup-content").html(a),showPopup("#error-popup")}function hideErrorPopup(){closePopup("#error-popup")}function showMessagePopup(a){jQuery("#message-popup .popup-content").html(a),showPopup("#message-popup")}function hideMessagePopup(){closePopup("#message-popup")}function PostCmtApiProcessor(){this.successListeners=Array(),this.failureListeners=Array()}function preCoreProcessor(a,b,c){return!0}function postCoreProcessorSuccess(a,b,c,d){}function postCoreProcessorFailure(a,b,c,d){}var Cmt=Cmt||{};if(Cmt.utils={},Cmt.utils.browser={isCanvas:function(){var a=document.createElement("canvas"),b=!(!a.getContext||!a.getContext("2d"));return b},isXhr:function(){var a=new XMLHttpRequest;return a.upload},isFileApi:function(){return window.File&&window.FileList&&window.FileReader},isFormData:function(){return!!window.FormData},isCanvasDataUrl:function(){var a=document.createElement("canvas"),b=a.toDataURL("image/png"),c=0==b.indexOf("data:image/png");return c}},Cmt.utils.image={arDimensions:function(a,b,c){var d=0,e=a.width,f=a.height;return e>b&&(d=b/e,f*=d,e*=d),f>c&&(d=c/f,e*=d),new Array(e,f)},drawOnCanvas:function(a,b){if(null!=a&&null!=b){var c=a.width,d=a.height,e=a.getContext("2d"),f=new Image,g=window.URL||window.webkitURL,h=g.createObjectURL(b);f.src=h,f.onload=function(){var a=Cmt.utils.image.arDimensions(f,c,d);e.translate(c/2,d/2),e.drawImage(f,-(a[0]/2),-(a[1]/2),a[0],a[1]),e.translate(-(c/2),-(d/2)),g.revokeObjectURL(h)}}}},Cmt.utils.data={serialiseElement:function(a){var b=[],c=jQuery("#"+a).find(":input").get();jQuery.each(c,function(){if(this.name&&!this.disabled&&(this.checked||/select|textarea/i.test(this.nodeName)||/text|hidden|password/i.test(this.type))){var a=jQuery(this).val();b.push(encodeURIComponent(this.name)+"="+encodeURIComponent(a))}});var d=b.join("&").replace(/%20/g,"+");if(null!=jQuery("meta[name=csrf-token]")){var e=jQuery("meta[name=csrf-token]").attr("content");d+="&_csrf="+e}return d},elementToJson:function(a){var b=[],c=jQuery("#"+a).find(":input").get();return jQuery.each(c,function(){if(this.name&&!this.disabled&&(this.checked||/select|textarea/i.test(this.nodeName)||/text|hidden|password/i.test(this.type))){var a=jQuery(this).val();b.push({name:this.name,value:a})}}),Cmt.utils.data.generateJsonMap(b)},serialiseForm:function(a){var b=null;if(b="string"==typeof a?jQuery("#"+a).serialize():a.serialize(),null!=jQuery("meta[name=csrf-token]")){var c=jQuery("meta[name=csrf-token]").attr("content");b+="&_csrf="+c}return b},formToJson:function(a){var b=null;return b="string"==typeof a?jQuery("#"+a).serializeArray():a.serializeArray(),Cmt.utils.data.generateJsonMap(b)},generateJsonMap:function(a){var b={};if(null!=jQuery("meta[name=csrf-token]")){var c=jQuery("meta[name=csrf-token]").attr("content");a.push({name:"_csrf",value:c})}return jQuery.map(a,function(a,c){var d=a.name.indexOf("[");if(d>-1){var e=b;_name=a.name.replace(/\]/gi,"").split("[");for(var c=0,f=_name.length;f>c;c++)c==f-1?e[_name[c]]?("string"==typeof e[_name[c]]&&(e[_name[c]]=[e[_name[c]]]),e[_name[c]].push(a.value)):e[_name[c]]=a.value||"":e=e[_name[c]]=e[_name[c]]||{}}else void 0!==b[a.name]?(b[a.name].push||(b[a.name]=[b[a.name]]),b[a.name].push(a.value||"")):b[a.name]=a.value||""}),b},updateUrlParam:function(a,b,c){var d,e,f="",g=jQuery("<a />").attr("href",a)[0],h=/\+/g,i=/([^&=]+)=?([^&]*)/g,j=function(a){return decodeURIComponent(a.replace(h," "))},k=g.search.substring(1);for(d={};e=i.exec(k);)d[j(e[1])]=j(e[2]);if(b||c){if(b&&!c)return d[b];d[b]=c;var l=[];for(var m in d)l.push(encodeURIComponent(m)+"="+encodeURIComponent(d[m]));return l.length>0&&(f="?"+l.join("&")),g.origin+g.pathname+f}return d},removeParam:function(a,b){var c=a.split("?")[0],d=null,e=[],f=-1!==a.indexOf("?")?a.split("?")[1]:"";if(""!==f){e=f.split("&");for(var g=e.length-1;g>=0;g-=1)d=e[g].split("=")[0],d===b&&e.splice(g,1);c=c+"?"+e.join("&")}return c}},Cmt.utils.ui={alignMiddle:function(a,b){var c=jQuery(a).height();jQuery(b).height(c),jQuery(b).css("line-height",c)}},"#_=_"==window.location.hash)if(history.replaceState){var cleanHref=window.location.href.split("#")[0];history.replaceState(null,null,cleanHref)}else window.location.hash="";!function(a){a.fn.cmtBlock=function(b){function c(b){if(a.inArray(b.attr("id"),i)>=0){var c=h[b.attr("id")],d=c.height,f=c.fullHeight,j=c.heightAuto,k=c.heightAutoMobile,l=c.heightAutoMobileWidth,m=c.css;if(null!=d&&d&&b.css({height:d+"px"}),null!=j&&j&&(null!=d&&d?b.css({height:"auto","min-height":d+"px"}):null!=f&&f&&b.css({height:"auto","min-height":g+"px"})),null==d&&null==j&&null!=f&&f&&b.css({height:g+"px"}),null!=k&&k&&window.innerWidth<=l){b.css({height:"auto","min-height":g+"px"});var n=b.children(".block-wrap-content");n.hasClass("valign-center")&&n.removeClass("valign-center")}null!=m&&m&&b.css(m)}else e.fullHeight&&b.css({height:g+"px"})}function d(){var b=a(window).height(),c=a(window).scrollTop(),d=c+b,e=c+b/2;f.each(function(f){var g=a(this),h=g.height(),i=g.offset().top,j=i+h,k=g.children(".block-bkg-parallax");if(null!=k&&k.length>0&&d>i&&j>c){var l=(k.width(),k.height()),m=0,n=l-b,o=b>h?l-h:l-b;i-=o,j+=o;var p=m+(n-m)*(e-i)/(j-i);k.css("background-position","50% "+p+"px")}})}var e=a.extend({},a.fn.cmtBlock.defaults,b),f=this,g=a(window).height(),h=(a(window).width(),e.blocks),i=Object.keys(h);f.each(function(){var b=a(this);c(b)}),e.backgroundParallax&&a(window).scroll(d)},a.fn.cmtBlock.defaults={fullHeight:!0,backgroundParallax:!0,blocks:{}}}(jQuery),function(a){a.fn.cmtFileUploader=function(b){function c(a){var b=a.find(".btn-show-chooser, .btn-direct-chooser");if(b.length>0&&b.click(function(){a.find(".wrap-chooser").toggle("slow"),a.find(".post-action").hide(),Cmt.utils.browser.isCanvas()&&"image"==a.attr("type")&&a.find(".preview canvas").hide(),a.find(".chooser .input, .direct-chooser .input").val("");var b=a.find(".preloader .preloader-bar");Cmt.utils.browser.isFileApi()?b.css("width","0%"):Cmt.utils.browser.isFormData()&&b.html("")}),Cmt.utils.browser.isFileApi()){var c=a.find(".chooser .input, .direct-chooser .input");c.change(function(b){e(b,a)});var f=a.find(".preview .wrap-drag");f.bind("dragover",function(a){d(a)}),f.bind("dragleave",function(a){d(a)}),f.bind("drop",function(b){e(b,a)})}else if(Cmt.utils.browser.isFormData()){var h=a.attr("directory"),i=a.attr("type"),c=a.find(".chooser .input, .direct-chooser .input");c.change(function(b){g(a,h,i)})}}function d(a){a.stopPropagation(),a.preventDefault()}function e(a,b){var c=b.attr("directory"),e=b.attr("type");d(a);var g=a.target.files||a.originalEvent.dataTransfer.files;if(i.preview&&Cmt.utils.browser.isCanvas()&&"image"==e){var h=b.find(".preview canvas");h.show(),Cmt.utils.image.drawOnCanvas(h[0],g[0])}f(b,c,e,g[0])}function f(a,b,c,d){var e=new XMLHttpRequest,f=d.type.toLowerCase(),g=jQuery.inArray(f,i.fileFormats),j=a.find(".preloader .preloader-bar"),k=new FormData;if(k.append("file",d),j.css("width","0%"),e.upload&&g){e.upload.onprogress=function(a){if(a.lengthComputable){var b=Math.round(100*a.loaded/a.total);j.css("width",b+"%")}},e.onreadystatechange=function(d){if(4==e.readyState&&200==e.status){var f=JSON.parse(e.responseText);1==f.result?i.uploadListener?i.uploadListener(a.attr("id"),b,c,f.data):h(a,b,c,f.data):alert("File upload failed.")}};var l=fileUploadUrl+"?directory="+encodeURIComponent(b)+"&type="+encodeURIComponent(c);e.open("POST",l,!0),e.send(k)}else alert("File format not allowed.")}function g(a,b,c){var d=a.find(".preloader .preloader-bar"),e=a.find(".chooser .input, .direct-chooser .input"),f=e.files[0],g=new FormData;fileName=f.name,d.html("Uploading file"),g.append("file",f);var j=fileUploadUrl+"?directory="+encodeURIComponent(b)+"&type="+encodeURIComponent(c);jQuery.ajax({type:"POST",url:j,data:g,cache:!1,contentType:!1,processData:!1,dataType:"json"}).done(function(d){progress.html("File uploaded"),1==d.result?i.uploadListener?i.uploadListener(a.attr("id"),b,c,d.data):h(a,b,c,d.data):alert("File upload failed.")})}function h(a,b,c,d){d.name+"."+d.extension;if("image"==c){a.find(".postview .wrap-image").html("<img src='"+d.tempUrl+"' class='fluid' />");var e=a.find(".fields");e.children(".name").val(d.name),e.children(".extension").val(d.extension),e.children(".change").val(1)}a.find(".wrap-chooser").hide(),a.find(".post-action").show()}var i=a.extend({},a.fn.cmtFileUploader.defaults,b),j=this;j.each(function(){var b=a(this);c(b)})},a.fn.cmtFileUploader.defaults={fileFormats:["jpg","jpeg","png","gif","pdf","csv"],uploadListener:null,preview:!0}}(jQuery),function(a){a.fn.cmtHeader=function(b){function c(a){e>d.minWidth&&window.addEventListener("scroll",function(b){var c=window.pageYOffset||document.documentElement.scrollTop,e=d.scrollDistance;c>e?(a.addClass("header-small"),a.hasClass("hidden")&&a.slideDown("slow")):(a.hasClass("header-small")&&a.removeClass("header-small"),a.hasClass("hidden")&&a.slideUp("false"))})}var d=a.extend({},a.fn.cmtHeader.defaults,b),e=window.innerWidth,f=this;f.each(function(){var b=a(this);c(b)})},a.fn.cmtHeader.defaults={minWidth:1024,scrollDistance:300}}(jQuery),function(a){a.fn.cmtPopup=function(b){function c(a){var b=a.children(".popup-data");b.children(".popup-close").click(function(){a.fadeOut("slow")}),d.modal&&(a.css({top:"0px",left:"0px",height:f,width:h}),a.children(".popup-background").css({top:"0px",left:"0px",height:g,width:h}),b.css({top:g/2-b.height()/2,left:h/2-b.width()/2}))}var d=a.extend({},a.fn.cmtPopup.defaults,b),e=this,f=a(document).height(),g=a(window).height(),h=a(window).width();e.each(function(){var b=a(this);c(b)})},a.fn.cmtPopup.defaults={modal:!0}}(jQuery),function(a){a.fn.cmtSelect=function(b){function c(b){var c=b.children("option:selected");b.wrap("<div></div>");var e=b.parent();if(d.copyId){var f=b.attr("id");null!=f&&f.length>0&&(b.attr("id",null),e.attr("id",f))}e.addClass("cmt-select-wrap"),null!=d.wrapperClass&&e.addClass(d.wrapperClass);var g="<span class='s-icon'>";null!=d.iconClass&&(g="<span class='s-icon "+d.iconClass+"'>"),g+=null!=d.iconHtml?d.iconHtml+"</span>":"</span>";var h="<div class='cmt-select'><div class='cmt-selected'><span class='s-text'>"+c.html()+"</span>"+g+"</div><ul class='cmt-select-list'>";b.find("option").each(function(a){h+="<li data-value='"+jQuery(this).val()+"'>"+jQuery(this).html()+"</li>"}),h+="</ul></div>",e.append(h);var i=(e.children(".cmt-select"),e.children(".cmt-select").children(".cmt-selected")),j=e.children(".cmt-select").children(".cmt-select-list");j.hide();var k=b.attr("disabled");"disabled"==k||k?i.addClass("disabled"):(i.click(function(b){var c=j.is(":visible");a(".cmt-select-list").hide(),c||j.show(),b.stopPropagation()}),j.children("li").click(function(){var a=jQuery(this),b=a.parents().eq(1);b.children(".cmt-selected").children(".s-text").html(a.html()),b.parent().children("select").val(a.attr("data-value")).change(),j.hide()}),a(document).on("click",function(b){0===a(b.target).closest(j).length&&j.hide()}))}var d=a.extend({},a.fn.cmtSelect.defaults,b),e=this;e.each(function(){var b=a(this);c(b)})},a.fn.cmtSelect.defaults={multi:!1,copyId:!1,wrapperClass:null,iconClass:null,iconHtml:null}}(jQuery),function(a){a.fn.cmtSmoothScroll=function(b){function c(b){b.on("click",function(b){b.preventDefault();var c=this.hash,d=a(c);jQuery("html, body").stop().animate({scrollTop:d.offset().top},900,"swing",function(){window.location.hash=c})})}var d=(a.extend({},a.fn.cmtSmoothScroll.defaults,b),this);d.each(function(){var b=a(this);c(b)})},a.fn.cmtSmoothScroll.defaults={}}(jQuery);var CONTROLLER_DEFAULT="default",ACTION_DEFAULT="default",ACTION_LOGIN="login",ACTION_AVATAR="avatar";!function(a){a.fn.processAjax=function(b){function c(a){d.form?a.submit(function(a){a.preventDefault();var b=jQuery(this).attr("id"),c=jQuery(this).attr("cmt-controller"),e=jQuery(this).attr("cmt-action");null==c&&(c=CONTROLLER_DEFAULT),null==e&&(e=ACTION_DEFAULT),d.json?Cmt.remote.handleRestForm(b,c,e):Cmt.remote.handleAjaxForm(b,c,e)}):(jQuery(a).find(".cmt-submit").click(function(a){a.preventDefault();var b=jQuery("#"+jQuery(this).attr("cmt-request")),c=b.attr("id"),d=b.attr("cmt-controller"),e=b.attr("cmt-action");null==d&&(d=CONTROLLER_DEFAULT),null==e&&(e=ACTION_DEFAULT),Cmt.remote.handleAjaxRequest(c,d,e)}),jQuery(a).find(".cmt-select").change(function(){var a=jQuery("#"+jQuery(this).attr("cmt-request")),b=a.attr("id"),c=a.attr("cmt-controller"),d=a.attr("cmt-action");null==c&&(c=CONTROLLER_DEFAULT),null==d&&(d=ACTION_DEFAULT),Cmt.remote.handleAjaxRequest(b,c,d)}))}var d=a.extend({},a.fn.processAjax.defaults,b),e=this;e.each(function(){var b=a(this);c(b)})},a.fn.processAjax.defaults={form:!0,json:!1}}(jQuery),Cmt.remote={errorClass:"error",messageClass:"message",spinnerClass:"spinner",handleAjaxForm:function(a,b,c){var d=jQuery("#"+a),e=d.attr("method"),f=d.attr("action"),g=jQuery("#"+a+" ."+this.messageClass);if(g.hide(),jQuery("#"+a+" ."+this.errorClass).hide(),!preCmtApiProcessor.processPre(a,b,c))return!1;var h=Cmt.utils.data.serialiseForm(a);return jQuery("#"+a+" ."+this.spinnerClass).show(),jQuery.ajax({type:e,url:f,data:h,dataType:"JSON",success:function(d,e,f){Cmt.remote.processAjaxResponse(a,b,c,g,d)}}),!1},handleRestForm:function(a,b,c){var d=jQuery("#"+a),e=d.attr("method"),f=d.attr("action"),g=jQuery("#"+a+" ."+this.messageClass);if(g.hide(),jQuery("#"+a+" ."+this.errorClass).hide(),!preCmtApiProcessor.processPre(a,b,c))return!1;var h=Cmt.utils.data.formToJson(a);return jQuery("#"+a+" ."+this.spinnerClass).show(),jQuery.ajax({type:e,url:f,data:JSON.stringify(h),dataType:"JSON",contentType:"application/json;charset=UTF-8",success:function(d,e,f){Cmt.remote.processAjaxResponse(a,b,c,g,d)}}),!1},handleAjaxRequest:function(a,b,c){var d=jQuery("#"+a),e=d.attr("method"),f=d.attr("action"),g=jQuery("#"+a+" ."+this.messageClass);if(null==e&&(e="post"),g.hide(),jQuery("#"+a+" ."+this.errorClass).hide(),!preCmtApiProcessor.processPre(a,b,c))return!1;var h=Cmt.utils.data.serialiseElement(a);return jQuery("#"+a+" ."+this.spinnerClass).show(),jQuery.ajax({type:e,url:f,data:h,dataType:"JSON",success:function(d,e,f){Cmt.remote.processAjaxResponse(a,b,c,g,d)}}),!1},processAjaxResponse:function(a,b,c,d,e){var f=e.result,g=e.message,h=(e.data,e.errors);if(1==f){d.html(g),d.show(),jQuery("#"+a+" ."+this.errorClass).hide(),jQuery("#"+a+" ."+this.spinnerClass).hide();var i=jQuery("#"+a).attr("cmt-clear-data");i=null==i?!0:"true"===i,i&&(jQuery("#"+a+" input[type='text']").val(""),jQuery("#"+a+" input[type='password']").val(""),jQuery("#"+a+" textarea").val("")),postCmtApiProcessor.processSuccess(a,b,c,e)}else if(0==f){d.html(g),d.show(),jQuery("#"+a+" ."+this.spinnerClass).hide();for(var j in h){var k=j,l=h[j],m=jQuery("#"+a+" span[cmt-error='"+k+"']");m.html(l),m.show()}postCmtApiProcessor.processFailure(a,b,c,e)}}},PreCmtApiProcessor=function(){this.formListeners=Array()},PreCmtApiProcessor.prototype.addListener=function(a){this.formListeners.push(a)},PreCmtApiProcessor.prototype.processPre=function(a,b,c){for(var d=this.formListeners,e=d.length,f=0;e>f;f++)if(!d[f](a,b,c))return!1;return!0},PostCmtApiProcessor.prototype.addSuccessListener=function(a){this.successListeners.push(a)},PostCmtApiProcessor.prototype.addFailureListener=function(a){this.failureListeners.push(a)},PostCmtApiProcessor.prototype.processSuccess=function(a,b,c,d){for(var e=this.successListeners,f=e.length,g=0;f>g;g++)e[g](a,b,c,d)},PostCmtApiProcessor.prototype.processFailure=function(a,b,c,d){for(var e=this.failureListeners,f=e.length,g=0;f>g;g++)e[g](a,b,c,d)};var preCmtApiProcessor=new PreCmtApiProcessor;preCmtApiProcessor.addListener(preCoreProcessor);var postCmtApiProcessor=new PostCmtApiProcessor;postCmtApiProcessor.addSuccessListener(postCoreProcessorSuccess),postCmtApiProcessor.addFailureListener(postCoreProcessorFailure);