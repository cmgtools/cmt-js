/**
 * CMGTools JS - v1.0.0-alpha1 - 2016-02-13
 * Description: CMGTools JS is a JavaScript library which provide utilities, ui components and MVC framework implementation for CMSGears.
 * License: GPLv3
 * Author: Bhagwat Singh Chouhan
 */

function showPopup(a){jQuery(a).fadeIn("slow")}function closePopup(a){jQuery(a).fadeOut("slow")}function showErrorPopup(a){jQuery("#error-popup .popup-content").html(a),showPopup("#error-popup")}function hideErrorPopup(){closePopup("#error-popup")}function showMessagePopup(a){jQuery("#message-popup .popup-content").html(a),showPopup("#message-popup")}function hideMessagePopup(){closePopup("#message-popup")}var cmt=cmt||{};if(cmt.utils=cmt.utils||{},cmt.utils.browser={isXhr:function(){var a=new XMLHttpRequest;return a.upload},isFileApi:function(){return window.File&&window.FileList&&window.FileReader},isFormData:function(){return!!window.FormData},isCanvas:function(){var a=document.createElement("canvas"),b=!(!a.getContext||!a.getContext("2d"));return b},isCanvasDataUrl:function(){var a=document.createElement("canvas"),b=a.toDataURL("image/png"),c=0==b.indexOf("data:image/png");return c}},cmt.utils.data={serialiseElement:function(a){var b=[],c=null;c="string"==typeof a?jQuery("#"+a).find(":input").get():a.find(":input").get(),jQuery.each(c,function(){if(this.name&&!this.disabled&&(this.checked||/select|textarea/i.test(this.nodeName)||/text|hidden|password/i.test(this.type))){var a=jQuery(this).val();b.push(encodeURIComponent(this.name)+"="+encodeURIComponent(a))}});var d=b.join("&").replace(/%20/g,"+");if(null!=jQuery("meta[name=csrf-token]")){var e=jQuery("meta[name=csrf-token]").attr("content");d+="&_csrf="+e}return d},elementToJson:function(a){var b=[],c=null;return c="string"==typeof a?jQuery("#"+a).find(":input").get():a.find(":input").get(),jQuery.each(c,function(){if(this.name&&!this.disabled&&(this.checked||/select|textarea/i.test(this.nodeName)||/text|hidden|password/i.test(this.type))){var a=jQuery(this).val();b.push({name:this.name,value:a})}}),cmt.utils.data.generateJsonMap(b)},serialiseForm:function(a){var b=null;if(b="string"==typeof a?jQuery("#"+a).serialize():a.serialize(),null!=jQuery("meta[name=csrf-token]")){var c=jQuery("meta[name=csrf-token]").attr("content");b+="&_csrf="+c}return b},formToJson:function(a){var b=null;return b="string"==typeof a?jQuery("#"+a).serializeArray():a.serializeArray(),cmt.utils.data.generateJsonMap(b)},generateJsonMap:function(a){var b={};if(null!=jQuery("meta[name=csrf-token]")){var c=jQuery("meta[name=csrf-token]").attr("content");a.push({name:"_csrf",value:c})}return jQuery.map(a,function(a,c){var d=a.name.indexOf("[");if(d>-1){var e=b;_name=a.name.replace(/\]/gi,"").split("[");for(var c=0,f=_name.length;f>c;c++)c==f-1?e[_name[c]]?("string"==typeof e[_name[c]]&&(e[_name[c]]=[e[_name[c]]]),e[_name[c]].push(a.value)):e[_name[c]]=a.value||"":e=e[_name[c]]=e[_name[c]]||{}}else void 0!==b[a.name]?(b[a.name].push||(b[a.name]=[b[a.name]]),b[a.name].push(a.value||"")):b[a.name]=a.value||""}),b},updateUrlParam:function(a,b,c){var d,e,f="",g=jQuery("<a />").attr("href",a)[0],h=/\+/g,i=/([^&=]+)=?([^&]*)/g,j=function(a){return decodeURIComponent(a.replace(h," "))},k=g.search.substring(1);for(d={};e=i.exec(k);)d[j(e[1])]=j(e[2]);if(b||c){if(b&&!c)return d[b];d[b]=c;var l=[];for(var m in d)l.push(encodeURIComponent(m)+"="+encodeURIComponent(d[m]));return l.length>0&&(f="?"+l.join("&")),g.origin+g.pathname+f}return d},removeParam:function(a,b){var c=a.split("?")[0],d=null,e=[],f=-1!==a.indexOf("?")?a.split("?")[1]:"";if(""!==f){e=f.split("&");for(var g=e.length-1;g>=0;g-=1)d=e[g].split("=")[0],d===b&&e.splice(g,1);c=c+"?"+e.join("&")}return c}},Function.prototype.inherits=function(a){var b=0,c=this.prototype=new a;this.prototype.uber=function(d){var e,f,g=b,h=a.prototype;if(g){for(;g;)h=h.constructor.prototype,g-=1;e=h[d]}else e=c[d],e==this[d]&&(e=h[d]);return b+=1,f=e.apply(this,Array.prototype.slice.apply(arguments,[1])),b-=1,f}},"#_=_"==window.location.hash)if(history.replaceState){var cleanHref=window.location.href.split("#")[0];history.replaceState(null,null,cleanHref)}else window.location.hash="";cmt.utils.image={arDimensions:function(a,b,c){var d=0,e=a.width,f=a.height;return e>b&&(d=b/e,f*=d,e*=d),f>c&&(d=c/f,e*=d),new Array(e,f)},drawAtCanvasCenter:function(a,b){if(null!=a&&null!=b){var c=a.width,d=a.height,e=a.getContext("2d"),f=new Image,g=window.URL||window.webkitURL,h=g.createObjectURL(b);f.src=h,f.onload=function(){var a=cmt.utils.image.arDimensions(f,c,d);e.translate(c/2,d/2),e.drawImage(f,-(a[0]/2),-(a[1]/2),a[0],a[1]),e.translate(-(c/2),-(d/2)),g.revokeObjectURL(h)}}}},cmt.utils.object={strToObject:function(a){for(var b=a.split("."),c=window||this,d=0,e=b.length;e>d;d++)c=c[b[d]];var f=new c;if("object"!=typeof f)throw new Error(a+" not found");return f}},cmt.utils.ui={alignMiddle:function(a,b){var a=jQuery(a),b=jQuery(b),c=a.height(),d=a.width(),e=b.height(),f=b.width();if(c>=e&&d>=f){var g=(c-e)/2,h=(d-f)/2;b.css({position:"absolute",top:g,left:h})}}},function(a){a.fn.cmtBlock=function(b){function c(b){if(a.inArray(b.attr("id"),i)>=0){var c=h[b.attr("id")],d=c.height,f=c.fullHeight,j=c.halfHeight,k=c.heightAuto,l=c.heightAutoMobile,m=c.heightAutoMobileWidth,n=c.css;if(null!=d&&d&&b.css({height:d+"px"}),null!=k&&k&&(null!=d&&d?b.css({height:"auto","min-height":d+"px"}):null!=f&&f?b.css({height:"auto","min-height":g+"px"}):null!=j&&j?b.css({height:"auto","min-height":g/2+"px"}):b.css({height:"auto"})),null==d&&null==k&&null!=f&&f&&b.css({height:g+"px"}),null==d&&null==k&&null!=j&&j&&b.css({height:g/2+"px"}),null!=l&&l&&window.innerWidth<=m){b.css({height:"auto","min-height":g+"px"});var o=b.children(".block-wrap-content");o.hasClass("valign-center")&&o.removeClass("valign-center")}var o=b.find(".block-wrap-content"),p=b.find(".block-content");if(void 0!==p&&p.height()>o.height()){var q=p.height()+100+"px",r=p.height()-o.height();o.height(q),q=b.height()+r+100+"px",b.height(q)}null!=n&&n&&b.css(n)}else e.fullHeight&&(e.heightAuto?b.css({height:"auto","min-height":g+"px"}):b.css({height:g+"px"})),e.halfHeight&&(e.heightAuto?b.css({height:"auto","min-height":g/2+"px"}):b.css({height:g/2+"px"}))}function d(){var b=a(window).height(),c=a(window).scrollTop(),d=c+b,e=c+b/2;f.each(function(f){var g=a(this),h=g.height(),i=g.offset().top,j=i+h,k=g.children(".block-bkg-parallax");if(null!=k&&k.length>0&&d>i&&j>c){var l=(k.width(),k.height()),m=0,n=l-b,o=b>h?l-h:l-b;i-=o,j+=o;var p=m+(n-m)*(e-i)/(j-i);k.css("background-position","50% "+p+"px")}})}var e=a.extend({},a.fn.cmtBlock.defaults,b),f=this,g=a(window).height(),h=(a(window).width(),e.blocks),i=Object.keys(h);f.each(function(){var b=a(this);c(b)}),e.backgroundParallax&&a(window).scroll(d)},a.fn.cmtBlock.defaults={fullHeight:!0,halfHeight:!1,heightAuto:!1,backgroundParallax:!0,blocks:{}}}(jQuery),function(a){a.fn.cmtCheckbox=function(b){function c(a){var b=a.find("input[type='checkbox']"),c=a.find("input[type='hidden']");1==c.val()&&b.prop("checked",!0),b.change(function(){b.is(":checked")?c.val(1):c.val(0)})}var d=(a.extend({},a.fn.cmtCheckbox.defaults,b),this);d.each(function(){var b=a(this);c(b)})},a.fn.cmtCheckbox.defaults={}}(jQuery),function(a){a.fn.cmtFileUploader=function(b){function c(a){var b=a.find(".btn-show-chooser, .btn-direct-chooser");if(b.length>0&&b.click(function(){a.find(".wrap-chooser").toggle("slow"),a.find(".post-action").hide(),cmt.utils.browser.isCanvas()&&"image"==a.attr("type")&&a.find(".preview canvas").hide(),a.find(".chooser .input, .direct-chooser .input").val("");var b=a.find(".preloader .preloader-bar");cmt.utils.browser.isFileApi()?b.css("width","0%"):cmt.utils.browser.isFormData()&&b.html("")}),cmt.utils.browser.isFileApi()){var c=a.find(".chooser .input, .direct-chooser .input");c.change(function(b){e(b,a)});var f=a.find(".preview .wrap-drag");f.bind("dragover",function(a){d(a)}),f.bind("dragleave",function(a){d(a)}),f.bind("drop",function(b){e(b,a)})}else if(cmt.utils.browser.isFormData()){var h=a.attr("directory"),i=a.attr("type"),c=a.find(".chooser .input, .direct-chooser .input");c.change(function(b){g(a,h,i)})}}function d(a){a.stopPropagation(),a.preventDefault()}function e(a,b){var c=b.attr("directory"),e=b.attr("type");d(a);var g=a.target.files||a.originalEvent.dataTransfer.files;if(i.preview&&cmt.utils.browser.isCanvas()&&"image"==e){var h=b.find(".preview canvas");h.show(),cmt.utils.image.drawAtCanvasCenter(h[0],g[0])}f(b,c,e,g[0])}function f(a,b,c,d){var e=new XMLHttpRequest,f=d.type.toLowerCase(),g=jQuery.inArray(f,i.fileFormats),j=a.find(".preloader .preloader-bar"),k=new FormData;if(k.append("file",d),j.css("width","0%"),e.upload&&g){e.upload.onprogress=function(a){if(a.lengthComputable){var b=Math.round(100*a.loaded/a.total);j.css("width",b+"%")}},e.onreadystatechange=function(d){if(4==e.readyState&&200==e.status){var f=JSON.parse(e.responseText);if(1==f.result){var g=f.data;i.uploadListener?i.uploadListener(a.attr("id"),b,c,g):h(a,b,c,g)}else{var g=f.errors;alert(g.error)}}};var l=fileUploadUrl+"?directory="+encodeURIComponent(b)+"&type="+encodeURIComponent(c);e.open("POST",l,!0),e.send(k)}else alert("File format not allowed.")}function g(a,b,c){var d=a.find(".preloader .preloader-bar"),e=a.find(".chooser .input, .direct-chooser .input"),f=e.files[0],g=new FormData;fileName=f.name,d.html("Uploading file"),g.append("file",f);var j=fileUploadUrl+"?directory="+encodeURIComponent(b)+"&type="+encodeURIComponent(c);jQuery.ajax({type:"POST",url:j,data:g,cache:!1,contentType:!1,processData:!1,dataType:"json"}).done(function(d){progress.html("File uploaded"),1==d.result?i.uploadListener?i.uploadListener(a.attr("id"),b,c,d.data):h(a,b,c,d.data):alert("File upload failed.")})}function h(a,b,c,d){d.name+"."+d.extension;switch(c){case"image":a.find(".postview .wrap-file").html("<img src='"+d.tempUrl+"' class='fluid' />");var e=a.find(".fields");e.children(".name").val(d.name),e.children(".extension").val(d.extension),e.children(".change").val(1);break;case"video":a.find(".postview .wrap-file").html("<video src='"+d.tempUrl+"' controls class='fluid'>Video not supported.</video>");var e=a.find(".fields");e.children(".name").val(d.name),e.children(".extension").val(d.extension),e.children(".change").val(1);break;case"document":case"compressed":a.find(".postview .wrap-file").html("<i class='cmti cmti-3x cmti-check'></i>");var e=a.find(".fields");e.children(".name").val(d.name),e.children(".extension").val(d.extension),e.children(".change").val(1)}a.find(".wrap-chooser").hide(),a.find(".post-action").show()}var i=a.extend({},a.fn.cmtFileUploader.defaults,b),j=this;j.each(function(){var b=a(this);c(b)})},a.fn.cmtFileUploader.defaults={fileFormats:["jpg","jpeg","png","gif","pdf","csv"],uploadListener:null,preview:!0}}(jQuery),function(a){a.fn.cmtFormInfo=function(b){function c(a){a.find(".btn-edit").click(function(){var a=jQuery(this).parent().find(".wrap-info"),b=jQuery(this).parent().find(".wrap-form");a.is(":visible")?(a.hide(),b.fadeIn("slow")):(a.fadeIn("fast"),b.hide())})}var d=(a.extend({},a.fn.cmtFormInfo.defaults,b),this);d.each(function(){var b=a(this);c(b)})},a.fn.cmtFormInfo.defaults={}}(jQuery),function(a){a.fn.cmtHeader=function(b){function c(a){e>d.minWidth&&window.addEventListener("scroll",function(b){var c=window.pageYOffset||document.documentElement.scrollTop,e=d.scrollDistance;c>e?(a.addClass("header-small"),a.hasClass("hidden")&&a.slideDown("slow")):(a.hasClass("header-small")&&a.removeClass("header-small"),a.hasClass("hidden")&&a.slideUp("false"))})}var d=a.extend({},a.fn.cmtHeader.defaults,b),e=window.innerWidth,f=this;f.each(function(){var b=a(this);c(b)})},a.fn.cmtHeader.defaults={minWidth:1024,scrollDistance:300}}(jQuery),function(a){a.fn.latLongPicker=function(b){function c(a){d(a)}function d(b){var c=a.extend(!0,{},j.mapOptions),d=b.find(".google-map").get(0),f=b.find(".latitude"),g=b.find(".longitude"),h=b.find(".zoom");f.length>0&&g.length>0&&(f=parseFloat(f.val()),g=parseFloat(g.val()),h=parseInt(h.val()),a.isNumeric(f)||a.isNumeric(g)||(f=j.latitude,g=j.longitude,b.find(".latitude").val(f),b.find(".longitude").val(g)),a.isNumeric(h)&&(c.zoom=h)),null==c.mapTypeId&&(c.mapTypeId=google.maps.MapTypeId.ROADMAP),c.center=new google.maps.LatLng(f,g);var k=new google.maps.Map(d,c),l=e(b,k,c);if(j.geocoder){var m=new google.maps.Geocoder;b.find(".search-box").change(function(){var c=a(this).val();m.geocode({address:c},function(a,c){if(c==google.maps.GeocoderStatus.OK){var d=a[0].geometry.location;i(b,k,d,l)}})})}if(j.places){var n=new google.maps.places.PlacesService(k);b.find(".search-box").change(function(){var c=a(this).val(),d={query:c};n.textSearch(d,function(a,c){if(c==google.maps.places.PlacesServiceStatus.OK){var d=a[0].geometry.location;i(b,k,d,l)}})})}return k}function e(a,b,c){var d=new google.maps.Marker({position:c.center,map:b,title:j.markerTitle,draggable:!0});return google.maps.event.addListener(d,"dragend",function(c){f(a,b,d.position)}),google.maps.event.addListener(b,"dblclick",function(c){g(a,b,c.latLng,d)}),google.maps.event.addListener(b,"click",function(c){g(a,b,c.latLng,d)}),google.maps.event.addListener(b,"zoom_changed",function(){h(a,b)}),d}function f(a,b,c){a.find(".latitude").val(c.lat),a.find(".longitude").val(c.lng),h(a,b)}function g(a,b,c,d){f(a,b,c),d.setPosition(c)}function h(a,b){a.find(".zoom").val(b.getZoom())}function i(a,b,c,d){f(a,b,c),b.setCenter(c),d.setPosition(c)}var j=a.extend({},a.fn.latLongPicker.defaults,b),k=this;k.each(function(){var b=a(this);c(b)})},a.fn.latLongPicker.defaults={map:null,latitude:0,longitude:0,markerTitle:"My Location",geocoder:!1,places:!0,mapOptions:{zoom:3,mapTypeId:null,mapTypeControl:!1,zoomControlOptions:!0,disableDoubleClickZoom:!0}}}(jQuery),function(a){a.fn.cmtSlidingMenu=function(b){function c(b){if(d.mainMenu){var c=a(document).height(),e=a(window).width();b.css({top:"0px",left:"0px",height:c,width:e})}null!=d.showTrigger&&a(d.showTrigger).click(function(){b.fadeIn();var a=b.find(".vnav-slider");"left"==d.position?a.animate({left:0}):"right"==d.position&&a.animate({right:0})}),null!=d.hideTrigger&&a(d.hideTrigger).click(function(){b.fadeOut();var a=b.find(".vnav-slider");"left"==d.position?a.animate({left:-a.width()}):"right"==d.position&&a.animate({right:-a.width()})}),b.find(".btn-close").click(function(){b.fadeOut();var a=b.find(".vnav-slider");"left"==d.position?a.animate({left:-a.width()}):"right"==d.position&&a.animate({right:-a.width()})});var f=b.find(".popup-bkg-filler");f.length>0&&(f.css({top:"0px",left:"0px",height:c,width:e}),f.click(function(){b.fadeOut("fast")}))}var d=a.extend({},a.fn.cmtSlidingMenu.defaults,b),e=this;e.each(function(){var b=a(this);c(b)})},a.fn.cmtSlidingMenu.defaults={position:"left",showTrigger:null,hideTrigger:null,mainMenu:!1}}(jQuery),function(a){a.fn.cmtPopup=function(b){function c(a){var b=a.children(".popup-data");if(b.children(".popup-close").click(function(){a.fadeOut("slow")}),d.modal){a.css({top:"0px",left:"0px",height:f,width:h});var c=a.find(".popup-bkg");c.length>0&&c.css({top:"0px",left:"0px",height:g,width:h});var e=a.find(".popup-bkg-filler");e.length>0&&(e.css({top:"0px",left:"0px",height:g,width:h}),e.click(function(){a.fadeOut("fast")})),a.show();var i=b.height(),j=b.width();a.hide(),b.css({top:g/2-i/2,left:h/2-j/2})}}var d=a.extend({},a.fn.cmtPopup.defaults,b),e=this,f=a(document).height(),g=a(window).height(),h=a(window).width();e.each(function(){var b=a(this);c(b)})},a.fn.cmtPopup.defaults={modal:!0}}(jQuery),function(a){a.fn.cmtSelect=function(b){function c(b){var c=b.children("option:selected");b.wrap("<div></div>");var e=b.parent();if(d.copyId){var f=b.attr("id");null!=f&&f.length>0&&(b.attr("id",null),e.attr("id",f))}e.addClass("cmt-select-wrap"),null!=d.wrapperClass&&e.addClass(d.wrapperClass);var g="<span class='s-icon'>";null!=d.iconClass&&(g="<span class='s-icon "+d.iconClass+"'>"),g+=null!=d.iconHtml?d.iconHtml+"</span>":"</span>";var h="<div class='cmt-select'><div class='cmt-selected'><span class='s-text'>"+c.html()+"</span>"+g+"</div><ul class='cmt-select-list'>";b.find("option").each(function(a){h+="<li data-value='"+jQuery(this).val()+"'>"+jQuery(this).html()+"</li>"}),h+="</ul></div>",e.append(h);var i=(e.children(".cmt-select"),e.children(".cmt-select").children(".cmt-selected")),j=e.children(".cmt-select").children(".cmt-select-list");j.hide();var k=b.attr("disabled");"disabled"==k||k?i.addClass("disabled"):(i.click(function(b){var c=j.is(":visible");a(".cmt-select-list").hide(),c||j.show(),b.stopPropagation()}),j.children("li").click(function(){var a=jQuery(this),b=a.parents().eq(1);b.children(".cmt-selected").children(".s-text").html(a.html()),b.parent().children("select").val(a.attr("data-value")).change(),j.hide()}),a(document).on("click",function(b){0===a(b.target).closest(j).length&&j.hide()}))}var d=a.extend({},a.fn.cmtSelect.defaults,b),e=this;e.each(function(){var b=a(this);c(b)})},a.fn.cmtSelect.defaults={multi:!1,copyId:!1,wrapperClass:null,iconClass:null,iconHtml:null}}(jQuery),function(a){a.fn.cmtSlider=function(b){function c(a){d(a),e(a),f(a)}function d(b){b.children().each(function(){var b=a(this);b.addClass("slide")});var c='<div class="slides-wrap">'+b.html()+"</div>";c+='<div class="control control-left"></div><div class="control control-right"></div>',b.html(c)}function e(b){var c=(b.width(),b.height(),b.find(".slides-wrap")),d=b.find(".slide"),e=d.width(),f=d.length,h=0;c.width(e*f),d.each(function(c){var d=a(this);d.css("left",h),d.attr("slide",c),h+=e,g(b,d)})}function f(b){var c=(b.find(".controls"),k.lControlContent),d=k.rControlContent,e=b.find(".control-left"),f=b.find(".control-right");e.html(c),f.html(d),e.click(function(){j(a(this).closest(".cmt-slider"))}),f.click(function(){i(a(this).closest(".cmt-slider"))})}function g(a,b){null!=k.onSlideClick&&(b.unbind("click"),b.click(function(){k.onSlideClick(a,b,b.attr("slide"))}))}function h(b){var c=b.find(".slide"),d=c.width(),e=0,f=b.find(".slides-wrap");f.css({left:"0px",right:""}),c.each(function(){a(this).css({left:e+"px",right:""}),a(this).removeClass("active"),e+=d})}function i(b){var c=b.find(".slide"),d=c.first(),e=d.width(),f=b.find(".slides-wrap");null!=k.preSlideChange&&k.preSlideChange(b,d,d.attr("slide")),f.animate({left:-e},{duration:500,complete:function(){var b=a(this).parent(),c=b.find(".slide"),d=c.first();d.insertAfter(c.eq(c.length-1)),d.css("right",-e),h(b)}}),d=c.first(),null!=k.postSlideChange&&k.postSlideChange(b,d,d.attr("slide"))}function j(b){var c=b.find(".slide"),d=c.first(),e=d.width(),f=b.find(".slides-wrap");null!=k.preSlideChange&&k.preSlideChange(b,d,d.attr("slide"));var g=c.last();g.insertBefore(c.eq(0)),g.css("left",-e);g.attr("slide");f.animate({left:e},{duration:500,complete:function(){var b=a(this).parent();h(b)}}),d=c.first(),null!=k.postSlideChange&&k.postSlideChange(b,d,d.attr("slide"))}var k=a.extend({},a.fn.cmtSlider,b),l=this;l.each(function(){var b=a(this);c(b)}),a(window).resize(function(){l.each(function(){var b=a(this);e(b)})})},a.fn.cmtSlider.defaults={lControlContent:null,rControlContent:null,onSlideClick:null,preSlideChange:null,postSlideChange:null}}(jQuery),function(a){a.fn.cmtSmoothScroll=function(b){function c(b){b.on("click",function(b){b.preventDefault();var c=this.hash,d=a(c);jQuery("html, body").stop().animate({scrollTop:d.offset().top},900,"swing",function(){window.location.hash=c})})}var d=(a.extend({},a.fn.cmtSmoothScroll.defaults,b),this);d.each(function(){var b=a(this);c(b)})},a.fn.cmtSmoothScroll.defaults={}}(jQuery),cmt.api={},cmt.api.Application=function(a){this.config={json:!1,basePath:null,csrfGet:!1,errorClass:".error",messageClass:".message",spinnerClass:".spinner"},jQuery.extend(this.config,a);var b=cmt.api.Application.CONTROLLER_DEFAULT;this.controllers=[],this.controllers[b]="cmt.api.controllers.DefaultController",this.activeControllers=[]},cmt.api.Application.CONTROLLER_DEFAULT="default",cmt.api.Application.ACTION_DEFAULT="default",cmt.api.Application.STATIC_CONTROLLER="cmt-controller",cmt.api.Application.STATIC_ACTION="cmt-action",cmt.api.Application.STATIC_CUSTOM="cmt-custom",cmt.api.Application.STATIC_ID="id",cmt.api.Application.STATIC_KEEP="cmt-keep",cmt.api.Application.STATIC_ERROR="cmt-error",cmt.api.Application.STATIC_CLICK=".cmt-click",cmt.api.Application.STATIC_CHANGE=".cmt-change",cmt.api.Application.STATIC_KEY_UP=".cmt-key-up",cmt.api.Application.STATIC_BLUR=".cmt-blur",cmt.api.Application.prototype.findController=function(a){if(this.activeControllers[a])return this.activeControllers[a];try{if(void 0==this.controllers[a])throw"Controller with alias "+a+" is not registered with this application.";var b=cmt.utils.object.strToObject(this.controllers[a]);return b.init(),this.activeControllers[a]=b,this.activeControllers[a]}catch(c){if(console.log(c),console.log("Falling back to default controller."),void 0!==this.controllers[cmt.api.Application.CONTROLLER_DEFAULT])return this.findController(cmt.api.Application.CONTROLLER_DEFAULT)}},cmt.api.Application.prototype.registerElements=function(a){var b=this;a.each(function(){var a=jQuery(this);a.is("form")&&(a.unbind("submit"),a.submit(function(c){c.preventDefault(),b.triggerRequest(a,!0)}));var c=a.find(cmt.api.Application.STATIC_CLICK);c.length>0&&(c.unbind("click"),c.click(function(c){c.preventDefault(),b.triggerRequest(a,!1)}));var d=a.find(cmt.api.Application.STATIC_CHANGE);d.length>0&&(d.unbind("change"),d.change(function(){b.triggerRequest(a,!1)}));var e=a.find(cmt.api.Application.STATIC_KEY_UP);e.length>0&&(e.unbind("keyup"),e.keyup(function(){b.triggerRequest(a,!1)}));var f=a.find(cmt.api.Application.STATIC_BLUR);f.length>0&&(f.unbind("blur"),f.blur(function(){b.triggerRequest(a,!1)}))})},cmt.api.Application.prototype.triggerRequest=function(a,b){var c=a.attr(cmt.api.Application.STATIC_CONTROLLER),d=a.attr(cmt.api.Application.STATIC_ACTION);null==c&&(c=cmt.api.Application.CONTROLLER_DEFAULT),null==d&&(d=cmt.api.Application.ACTION_DEFAULT);var e=this.findController(c);b?this.config.json?this.handleJsonForm(a,e,d):this.handleDataForm(a,e,d):this.handleRequest(a,e,d)},cmt.api.Application.prototype.handleJsonForm=function(a,b,c){if(this.preProcessRequest(a,b,c)){var d=b.requestData;a.is("["+cmt.api.Application.STATIC_CUSTOM+"]")||(d=cmt.utils.data.formToJson(a)),this.processRequest(a,b,c,d)}return!1},cmt.api.Application.prototype.handleDataForm=function(a,b,c){if(this.preProcessRequest(a,b,c)){var d=b.requestData;a.is("["+cmt.api.Application.STATIC_CUSTOM+"]")||(d=cmt.utils.data.serialiseForm(a)),this.processRequest(a,b,c,d)}return!1},cmt.api.Application.prototype.handleRequest=function(a,b,c){if(this.preProcessRequest(a,b,c)){var d=b.requestData;a.is("["+cmt.api.Application.STATIC_CUSTOM+"]")||(d=cmt.utils.data.serialiseElement(a)),this.processRequest(a,b,c,d)}return!1},cmt.api.Application.prototype.preProcessRequest=function(a,b,c){var d=c+"ActionPre";return a.find(this.config.messageClass).hide(),a.find(this.config.errorClass).hide(),"undefined"==typeof b[d]||b[d](a)?(a.find(this.config.spinnerClass).show(),!0):!1},cmt.api.Application.prototype.processRequest=function(a,b,c,d){var e=this,f="post",g=a.attr("action");a.attr("method")&&(f=a.attr("method")),null!=e.config.basePath&&(g=e.config.basePath+g),this.config.json?jQuery.ajax({type:f,url:g,data:d,dataType:"JSON",contentType:"application/json;charset=UTF-8",success:function(d,f,g){e.processResponse(a,b,c,d)}}):jQuery.ajax({type:f,url:g,data:d,dataType:"JSON",success:function(d,f,g){e.processResponse(a,b,c,d)}})},cmt.api.Application.prototype.processResponse=function(a,b,c,d){var e=d.result,f=d.errors;if(1==e)a.is("["+cmt.api.Application.STATIC_KEEP+"]")||(a.find(' input[type="text"]').val(""),a.find(' input[type="password"]').val(""),a.find(" textarea").val("")),a.find(this.config.errorClass).hide();else if(0==e)for(var g in f){var h=g,i=f[g],j=a.find(" span["+cmt.api.Application.STATIC_ERROR+'="'+h+'"]');j.html(i),j.show()}this.postProcessResponse(a,b,c,d)},cmt.api.Application.prototype.postProcessResponse=function(a,b,c,d){var e=a.find(this.config.messageClass),f=d.message,g=c+"ActionPost";e.html(f),e.show(),a.find(this.config.spinnerClass).hide(),"undefined"!=typeof b[g]&&b[g](d.result,a,d)},function(a){a.fn.cmtRequestProcessor=function(b){var c=a.extend({},a.fn.cmtRequestProcessor.defaults,b),d=c.app;null!=d&&(d.controllers=a.extend([],d.controllers,c.controllers),d.registerElements(this))},a.fn.cmtRequestProcessor.defaults={app:null,controllers:[]}}(jQuery),cmt.api.controllers=cmt.api.controllers||{},cmt.api.controllers.BaseController=function(){},cmt.api.controllers.BaseController.prototype.init=function(){},cmt.api.controllers.DefaultController=function(){this.requestData=null},cmt.api.controllers.DefaultController.inherits(cmt.api.controllers.BaseController),cmt.api.controllers.DefaultController.prototype.init=function(){console.log("Initialised default controller.")},cmt.api.controllers.DefaultController.prototype.defaultActionPre=function(a){return console.log("Pre processing default action."),!0},cmt.api.controllers.DefaultController.prototype.defaultActionPost=function(a,b,c){a?console.log("Processing success for default action."):console.log("Processing failure for default action.")},cmt.api.controllers.GridController=function(){this.endpoint=null,this.model=null,this.collection=null,this.pages=0,this.pageLimit=0,this.lastPage=0},cmt.api.controllers.GridController.inherits(cmt.api.controllers.BaseController),cmt.api.controllers.GridController.prototype.init=function(){console.log("Initialised grid controller.")},cmt.api.controllers.GridController.prototype.allActionPre=function(){return console.log("Pre processing all action."),!0},cmt.api.controllers.GridController.prototype.allActionPost=function(a,b){a?console.log("Processing success for all action."):console.log("Processing failure for all action.")},cmt.api.controllers.GridController.prototype.createActionPre=function(){return console.log("Pre processing create action."),!0},cmt.api.controllers.GridController.prototype.createActionPost=function(a,b){a?console.log("Processing success for create action."):console.log("Processing failure for create action.")},cmt.api.controllers.GridController.prototype.updateActionPre=function(){return console.log("Pre processing update action."),!0},cmt.api.controllers.GridController.prototype.updateActionPost=function(a,b){a?console.log("Processing success for update action."):console.log("Processing failure for update action.")},cmt.api.controllers.GridController.prototype.deleteActionPre=function(){return console.log("Pre processing delete action."),!0},cmt.api.controllers.GridController.prototype.deleteActionPost=function(a,b){a?console.log("Processing success for delete action."):console.log("Processing failure for delete action.")},cmt.api.controllers.RequestController=function(){this.requestData=null},cmt.api.controllers.RequestController.inherits(cmt.api.controllers.BaseController),cmt.api.controllers.RequestController.prototype.init=function(){console.log("Initialised default controller.")},cmt.api.controllers.RequestController.prototype.defaultAction=function(){console.log("Pre processing default action.")},cmt.api.controllers.RequestController.prototype.defaultActionPre=function(){return console.log("Pre processing default action."),!0},cmt.api.controllers.RequestController.prototype.defaultActionPost=function(a,b){a?console.log("Processing success for default action."):console.log("Processing failure for default action.")},cmt.api.controllers.RestController=function(){this.endpoint=null,this.model=null,this.collection=null,this.pages=0,this.pageLimit=0,this.lastPage=0},cmt.api.controllers.RestController.inherits(cmt.api.controllers.BaseController),cmt.api.controllers.RestController.prototype.init=function(){console.log("Initialised rest controller.")},cmt.api.controllers.RestController.prototype.getActionPre=function(){return console.log("Pre processing get action."),!0},cmt.api.controllers.RestController.prototype.getActionPost=function(a,b){a?console.log("Processing success for get action."):console.log("Processing failure for get action.")},cmt.api.controllers.RestController.prototype.postActionPre=function(){return console.log("Pre processing post action."),!0},cmt.api.controllers.RestController.prototype.postActionPost=function(a,b){a?console.log("Processing success for post action."):console.log("Processing failure for post action.")},cmt.api.controllers.RestController.prototype.putActionPre=function(){return console.log("Pre processing put action."),!0},cmt.api.controllers.RestController.prototype.putActionPost=function(a,b){a?console.log("Processing success for put action."):console.log("Processing failure for put action.")},cmt.api.controllers.RestController.prototype.deleteActionPre=function(){return console.log("Pre processing delete action."),!0},cmt.api.controllers.RestController.prototype.deleteActionPost=function(a,b){a?console.log("Processing success for delete action."):console.log("Processing failure for delete action.")};